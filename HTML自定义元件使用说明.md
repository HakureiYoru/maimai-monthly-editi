# HTML自定义元件使用说明

## 将HTML代码添加到Wix自定义HTML元件

### 步骤1：在Wix编辑器中添加HTML元件

1. 打开 Wix 编辑器
2. 进入"Mission_任务"页面（或你创建的任务页面）
3. 点击左侧工具栏的 **➕ 添加元素**
4. 选择 **嵌入代码** → **HTML iframe**
5. 将HTML元件拖放到页面上
6. 调整元件大小（建议设置为占据页面主要区域）

### 步骤2：设置HTML元件ID

1. 选中刚添加的HTML元件
2. 在右侧属性面板中，点击 **设置** 标签
3. 在 **元件ID** 中输入：`html1`（必须是这个ID，因为代码中使用了这个ID）
4. 确认ID已保存

### 步骤3：添加HTML代码

1. 选中HTML元件
2. 点击右侧属性面板中的 **输入代码** 或 **编辑代码** 按钮
3. 在弹出的代码编辑器中，选择 **代码** 标签
4. 将 `src/public/custom-html/task-interface.html` 文件的**完整内容**复制粘贴进去
5. 点击 **更新** 保存

### 步骤4：配置HTML元件设置

在HTML元件的设置面板中：

#### 基本设置
- **宽度**: 100%（或固定宽度如800px）
- **高度**: 建议至少 700px（根据内容调整）
- **对齐方式**: 居中

#### 高级设置
- **允许脚本**: ✅ 启用（必须）
- **允许消息传递**: ✅ 启用（必须）
- **沙盒模式**: ❌ 禁用（或根据需要配置）

### 步骤5：测试元件

1. 点击右上角 **预览** 按钮
2. 登录一个测试账号
3. 导航到任务页面
4. 检查是否正确显示任务界面

---

## 完整的HTML代码文件位置

HTML代码已保存在：
```
src/public/custom-html/task-interface.html
```

**重要**：复制整个文件的内容（包括 `<!DOCTYPE html>` 到 `</html>` 的所有内容）

---

## 常见问题

### Q1: HTML元件显示空白
**可能原因**：
- 代码未正确粘贴
- 未启用脚本权限
- 未启用消息传递

**解决方法**：
- 检查代码编辑器中是否有完整的HTML代码
- 确保"允许脚本"和"允许消息传递"都已启用
- 查看浏览器控制台是否有错误信息

### Q2: 显示"加载中..."但不显示数据
**可能原因**：
- HTML元件ID不是 `html1`
- 后端函数未正确配置
- 权限设置有误

**解决方法**：
- 确认HTML元件ID为 `html1`
- 检查 `src/pages/Mission_任务.w3eih.js` 是否正确配置
- 检查 `permissions.json` 中的权限设置

### Q3: 点击"前往评分"按钮无反应
**可能原因**：
- 页面跳转路径配置错误
- 消息传递被阻止

**解决方法**：
- 检查 `Mission_任务.w3eih.js` 中的 `goToRatePage` 函数
- 确认主会场页面的URL路径
- 查看浏览器控制台的错误信息

### Q4: 样式显示异常
**可能原因**：
- HTML代码不完整
- 浏览器兼容性问题

**解决方法**：
- 重新复制完整的HTML代码
- 在不同浏览器中测试
- 清除浏览器缓存

---

## 样式自定义

如果需要调整界面样式，可以修改HTML文件中的 `<style>` 标签内容：

### 修改颜色主题
```css
/* 主渐变色 */
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);

/* 修改为其他颜色，例如绿色系 */
background: linear-gradient(135deg, #56ab2f 0%, #a8e063 100%);
```

### 修改字体大小
```css
/* 标题大小 */
.progress-title {
  font-size: 24px;  /* 改为其他值如 28px */
}

/* 作品编号大小 */
.work-number {
  font-size: 32px;  /* 改为其他值如 36px */
}
```

### 修改进度条颜色
```css
.progress-bar {
  background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
  /* 改为其他颜色 */
}
```

---

## 响应式设计

HTML代码已包含响应式设计，在移动设备上会自动调整：

- 手机端：单列布局，字体缩小
- 平板端：中等布局
- 电脑端：完整布局

如果需要调整断点，修改 `@media` 查询：

```css
@media (max-width: 768px) {
  /* 在768px以下的设备上应用这些样式 */
}
```

---

## 调试技巧

### 1. 查看消息传递
在浏览器控制台输入：
```javascript
window.addEventListener('message', (e) => {
  console.log('收到消息:', e.data);
});
```

### 2. 测试HTML元件
在Wix代码中添加测试按钮：
```javascript
$w('#testButton').onClick(() => {
  $w('#html1').postMessage({
    type: 'REFRESH_TASK',
    data: {}
  });
});
```

### 3. 检查元件状态
```javascript
console.log('HTML元件:', $w('#html1'));
console.log('是否可见:', $w('#html1').hidden);
```

---

## 性能优化建议

1. **延迟加载**：如果任务页面不是首页，可以设置为延迟加载
2. **缓存数据**：避免频繁调用后端API
3. **减少DOM操作**：批量更新已完成列表

---

## 安全注意事项

1. ✅ 已实施消息来源验证
2. ✅ 已实施用户权限检查
3. ✅ 已实施数据格式验证
4. ❌ 建议：在生产环境中添加HTTPS强制

---

完成以上步骤后，HTML自定义元件应该能够正常工作！


