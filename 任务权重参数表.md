# 任务权重算法 - 参数速查表

## 📊 核心公式

```
最终权重 = 基础冷门权重 × 均衡因子

基础冷门权重 = (评分缺口比例 × 缺口系数) + 时间紧迫度加成

评分缺口比例 = (期望评分 - 当前评分) / 期望评分
```

---

## 📋 当前参数 vs 建议调整

### 1. 基础权重参数

| 参数 | 当前值 | 调整后 | 说明 |
|------|--------|--------|------|
| **缺口系数** | 45 | **60** | 缺口比例的放大倍数 |
| **期望评分数** | 20 | 20 | 目标评分人数（不变） |
| **权重底数** | 0 | **15** | 最低基础权重保底值 |

**调整前公式**：
```
基础权重 = 缺口比例 × 45
```

**调整后公式**：
```
基础权重 = 缺口比例 × 60 + 15
```

**效果对比**：
| 评分数 | 缺口% | 旧基础权重 | 新基础权重 | 提升 |
|--------|-------|-----------|-----------|------|
| 0 | 100% | 45 | 75 | +67% |
| 5 | 75% | 34 | 60 | +76% |
| 10 | 50% | 23 | 45 | +96% |
| 15 | 25% | 11 | 30 | +173% |
| 18 | 10% | 5 | 21 | +320% |
| 19 | 5% | 2 | 18 | +800% |

---

### 2. 时间紧迫度加成

| 条件 | 当前加成 | 调整后 | 变化 |
|------|---------|--------|------|
| **3天 且 <2评** | 无 | **+15** | 新增 |
| **5天 且 <5评** | 无 | **+20** | 新增 |
| **7天 且 <10评** | +12 | **+30** | +150% |
| **14天 且 <15评** | +18 | **+45** | +150% |
| **21天 且 <18评** | +25 | **+65** | +160% |
| **30天 且 <20评** | 无 | **+80** | 新增 |

**特点**：
- ✅ 新增早期冷启动加成（3天、5天）
- ✅ 所有阶段加成大幅提升
- ✅ 超期作品获得最高优先级

---

### 3. 均衡因子参数

| 高权重占比区间 | Qualified用户 | 普通用户 | 状态 | 当前区间 | 调整建议 |
|---------------|--------------|----------|------|---------|---------|
| < 28% | ×1.3 | ×0.7 | 高权重严重不足 | < 40% | **采纳** |
| 28% - 45% | ×1.0 | ×1.0 | 均衡区间 | 40% - 60% | **采纳** |
| > 45% | ×0.7 | ×1.3 | 高权重过多 | > 60% | **采纳** |

**调整说明**：
- 从 40%-60% 调整到 **28%-45%**，更接近目标比例 1:2 (33.3%)
- 均衡因子保持 0.7/1.0/1.3 不变

---

### 4. 边界条件

| 条件 | 处理方式 |
|------|---------|
| 评分 = 0 | 基础权重 = 75，均衡因子 = 1.0 |
| 评分 ≥ 20 | **权重 = 0，不出现在任务列表** ✓ |
| 评分 > 20 | 权重 = 0 |
| 作品被淘汰 (isDq=true) | 排除，不计入任务池 |

---

## 📈 权重分布预测（调整后）

### 典型场景权重表

| 场景 | 天数 | 评分 | 高/低 | 基础 | 加成 | Q权重 | L权重 |
|------|------|------|-------|------|------|-------|-------|
| 新作品-无评分 | 2 | 0 | 0/0 | 75 | 0 | 75 | 75 |
| 冷启动-极少评 | 3 | 1 | 1/0 | 72 | +15 | 87×1.3=**113** | 87×0.7=61 |
| 中期-比例均衡 | 10 | 10 | 4/6 | 45 | +30 | 75 | 75 |
| 中期-高权重多 | 10 | 10 | 7/3 | 45 | +30 | 75×0.7=53 | 75×1.3=**98** |
| 后期-严重滞后 | 21 | 10 | 4/6 | 45 | +65 | 110 | 110 |
| 超期-极冷门 | 30 | 5 | 2/3 | 60 | +80 | 140 | 140 |
| 接近目标 | 20 | 19 | 7/12 | 18 | +65 | 83 | 83 |

**观察**：
- 冷启动阶段权重显著提升，新作品能快速获得关注
- 中期作品即使有10评，权重仍保持在45以上
- 超期冷门作品权重可达140，获得最高优先级
- 接近目标的作品仍有足够权重不至于被遗忘

---

## 🔧 代码实现位置

### ratingTaskManager.jsw 需要修改的行数：

| 参数 | 代码行 | 当前值 | 修改为 |
|------|--------|--------|--------|
| 缺口系数 | 473行 | `× 45` | `× 60` |
| 底数 | 473行 | 无 | `+ 15` |
| 3天加成 | 476-478行 | 无 | 新增判断 |
| 5天加成 | 476-478行 | 无 | 新增判断 |
| 7天加成 | 477行 | `+12` | `+30` |
| 14天加成 | 480行 | `+18` | `+45` |
| 21天加成 | 483行 | `+25` | `+65` |
| 30天加成 | 483行后 | 无 | 新增判断 |
| 均衡区间 | 422/433行 | `±0.1` | `调整逻辑` |

---

## 📊 调整前后对比

### 场景1: 中期作品 (10天, 10评分, 均衡)

```
调整前: 缺口50% × 45 + 30 = 52.5 → 53
调整后: 缺口50% × 60 + 15 + 30 = 90
提升: +70%
```

### 场景2: 接近目标 (20天, 18评分, 均衡)

```
调整前: 缺口10% × 45 + 25 = 29.5 → 30
调整后: 缺口10% × 60 + 15 + 65 = 86
提升: +187%
```

### 场景3: 超期冷门 (30天, 5评分, 均衡)

```
调整前: 缺口75% × 45 + 25 = 58.75 → 59
调整后: 缺口75% × 60 + 15 + 80 = 140
提升: +137%
```

---

## ⚠️ 重要说明

1. **权重上限**: 理论最大约 **155** (100%缺口 + 最高加成)
2. **权重下限**: 达标作品(≥20评) = **0**，不再出现
3. **均衡机制**: 在基础权重上乘以 0.7-1.3 的因子
4. **刷新间隔**: 24小时自动刷新任务列表

---

## 快速参考

### 判断作品紧急度

| 权重区间 | 紧急程度 | 典型特征 |
|---------|---------|---------|
| 120+ | 🔴 极度紧急 | 超期严重冷门 |
| 90-119 | 🟠 非常紧急 | 后期滞后或早期冷启动 |
| 60-89 | 🟡 中度紧急 | 中期评分不足 |
| 30-59 | 🟢 一般关注 | 进度正常 |
| 1-29 | 🔵 低优先级 | 接近目标 |
| 0 | ⚪ 已完成 | 达标作品 |

---

**文档版本**: v2.0-调整版  
**最后更新**: 2025-01-13  
**对应代码**: ratingTaskManager.jsw

